(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[14],{"6b35":function(t,e,o){"use strict";o.r(e);var i=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("q-page",{staticClass:"bg-background-light"},[o("q-card",{staticClass:" q-py-sm ",staticStyle:{"margin-bottom":"6px"},attrs:{flat:"",square:""}},[o("q-item",{staticClass:"q-pb-none"},[o("q-item-section",{staticStyle:{"min-width":"38px","padding-right":"12px"},attrs:{avatar:""}},[o("q-avatar",{attrs:{size:"38px"}},[o("img",{attrs:{src:t.Reply.author_head}})])],1),o("q-item-section",{attrs:{"no-wrap":""}},[o("q-item-label",{staticClass:"text-color-1 text-bold text-subtitle1"},[t._v(t._s(t.Reply.author_name))]),o("q-item-label",{staticClass:"text-color-2",attrs:{caption:""}},[t._v(t._s(t.Reply.time_before))])],1),o("q-item-section",{attrs:{side:"",top:""}},[t.Reply.author!=t.$store.state.account.id?o("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"more_vert"},on:{click:function(e){return t.block(t.Reply,-1,!0)}}}):t._e()],1)],1),o("q-card-section",{attrs:{horizontal:""}},[o("q-card-section",{staticClass:"text-color-2",domProps:{innerHTML:t._s(t.Reply.content)}})],1),o("q-item",{staticClass:"q-py-none",attrs:{dense:""}},[o("q-item-section",[o("q-item-label",[o("q-btn",{attrs:{id:t.$store.state.global.gaHead+"communitydetail_feedreply_post_like",dense:"",flat:"",align:"left",icon:t.Reply.my_like?"favorite":"favorite_border",label:t.Reply.likes_count,"text-color":t.Reply.my_like?"redheart":"text-color-2"},on:{click:function(e){return t.like(t.Reply,!t.Reply.my_like)}}})],1)],1),o("q-item-section",[o("q-item-label",[o("q-btn",{attrs:{dense:"",flat:"",align:"left",icon:"far fa-comment",label:t.Reply.reply_count,"text-color":"text-color-2"}})],1)],1)],1)],1),o("div",{staticClass:"row bg-feeds-messagebg q-col-gutter-sm items-center q-pb-sm q-pl-sm  q-pr-sm ",staticStyle:{margin:"10px 0"}},[o("div",{staticClass:"col-auto "},[o("q-avatar",{attrs:{size:"33px"}},[o("img",{attrs:{src:t.$store.state.account.head}})])],1),o("div",{staticClass:"col full-width"},[o("q-input",{staticClass:"bg-white",attrs:{dense:"",color:"blueGrey",clearable:"",autogrow:"",outlined:"",placeholder:"以"+t.$store.state.account.user.account+" 發表回應"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),o("div",{staticClass:"col-auto"},[o("q-btn",{attrs:{id:t.$store.state.global.gaHead+"communitydetail_feedreply_post_comment",dense:"",round:"",flat:"",icon:"send",disable:!t.message,color:"blueGrey"},on:{click:t.postComment}})],1)]),o("q-infinite-scroll",{ref:"forum",attrs:{offset:250,"initial-index":0},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[o("div",{staticClass:"full-width text-center q-pa-md "},[o("q-spinner-ios",{attrs:{size:"30px",color:"bluegrey"}})],1)]},proxy:!0}])},t._l(t.topicReply,(function(e,i){return o("q-card",{key:i,staticClass:"  ",staticStyle:{"margin-bottom":"10px"},attrs:{flat:"",square:""}},[o("q-item",{staticStyle:{padding:"12px"}},[o("q-item-section",{staticStyle:{"min-width":"30px","padding-right":"12px"},attrs:{avatar:"",top:""}},[o("q-avatar",{attrs:{size:"30px"}},[o("img",{attrs:{src:e.author_head}})])],1),o("q-item-section",[o("div",{staticClass:"text-color-1 text-bold q-pb-xs text-subtitle1"},[t._v("\n            "+t._s(e.author_name)+"\n          ")]),o("div",{staticClass:"text-color-2  q-pb-sm",staticStyle:{"font-size":"15px"},domProps:{innerHTML:t._s(e.content)}}),o("div",{staticClass:"text-color-2 text-caption"},[t._v(t._s(e.time_before))])]),o("q-item-section",{attrs:{side:"",top:""}},[e.author==t.$store.state.account.id?o("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"more_vert"},on:{click:function(o){return t.myActions(e,i)}}}):o("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"more_vert"},on:{click:function(o){return t.block(e,i)}}})],1)],1)],1)})),1)],1)},a=[],s=(o("7f7f"),o("6b54"),o("06db"),o("7514"),o("872c")),n={name:"feeds",mixins:[s["a"]],beforeMount:function(){var t=this;this.forumId=this.$route.params.forumId,this.UID=this.$route.params.uid,this.forum=this.$_.find(this.$store.state.system.forums,(function(e){return t.forumId==e.id.toString()})),this.forumAdminList.push(this.forum.host.email),this.forum.managers.forEach((function(e){t.forumAdminList.push(e.email)})),this.title=this.forum.name},mounted:function(){},data:function(){return{forum:{},forumId:this.$route.params.forumId,UID:this.$route.params.uid,message:"",topicReply:[],Reply:{},forumAdminList:[]}},computed:{isAdmin:function(){return this.forumAdminList.indexOf(this.$store.state.account.user.email)>=0}},methods:{init:function(){this.topicReply=[],this.$refs.forum.reset(),this.$refs.forum.poll()},onLoad:function(t,e){var o=this;this.$api.forum.ForumReplyList(this.UID,this.forumId,t-1).then((function(t){var i=t.data;0==i.result?(0==i.data.reply.length?e(!0):e(),i.data.content=i.data.content.replaceAll("\n","<br/>"),i.data.reply.length>0&&i.data.reply.forEach((function(t){t.content=t.content.replaceAll("\n","<br/>")})),o.Reply=i.data,o.topicReply=o.$_.concat(o.topicReply,i.data.reply)):o.$q.dialog({title:"發生錯誤",html:!0,message:"發生系統錯誤=>".concat(i.message,", 請通知客服人員。")}).onOk((function(){})).onCancel((function(){})).onDismiss((function(){e(!0),o.$router.go(-1)}))})).catch((function(t){console.log(t)})).then((function(){console.log(o.topicReply)}))},like:function(t,e){var o=t.my_like;t.my_like=e,e?t.likes_count++:t.likes_count--,this.$api.forum.ForumLike(t.uid,e,this.forumId).then((function(t){})).catch((function(i){t.my_like=o,e?t.likes_count--:t.likes_count++}))},postComment:function(){var t=this;this.isLoading=!0,this.$api.forum.ForumReply(this.UID,this.message,this.forumId).then((function(e){var o={author:t.$store.state.account.id,author_head:t.$store.state.account.head,author_name:t.$store.state.account.user.account,content:t.message,forum_id:t.forumId,likes_count:0,my_like:!1,parent_uid:t.UID,reply:[],reply_count:0,time:"",time_before:"剛才",uid:e.data.data.new_id};t.Reply.reply_count++,t.topicReply.unshift(o),t.message=""})).catch((function(t){})).then((function(){t.isLoading=!1}))},myActions:function(t,e,o){var i=this,a=this.$q.bottomSheet({class:"sheet-actions",actions:[{label:"刪除",id:"delete"},{label:"取消",id:"cancel"}]}).onOk((function(s){i.forumAction(s,a,t,e,o)}))},block:function(t,e,o){var i=this,a=[{label:"封鎖使用者",id:"user"},{label:"隱藏此貼文",id:"hide"},{label:"檢舉此貼文",id:"report"},{label:"取消",id:"cancel"}];this.isAdmin&&a.splice(0,0,{label:"刪除(管理者)",id:"delete"});var s=this.$q.bottomSheet({class:"sheet-actions",actions:a}).onOk((function(a){i.forumAction(a,s,t,e,o)})).onCancel((function(){})).onDismiss((function(){}))},forumAction:function(t,e,o,i,a){var s=this;switch(t.id){case"delete":this.$api.forum.ForumRemove(o.uid,this.forumId).then((function(t){var e=0==t.data.result?"此文章已刪除":t.data.message;s.$q.notify({message:e}),s.topicReply.splice(i,1)})).catch((function(t){})).then((function(){}));break;case"cancel":e.hide();break;case"hide":this.$api.forum.ForumHide(o.uid,this.forumId).then((function(t){var e=0==t.data.result?"此文章已過濾":t.data.message;s.$q.notify({message:e}),a?s.$router.go(-1):s.topicReply.splice(i,1)})).catch((function(t){})).then((function(){}));break;case"user":this.$api.forum.ForumReport(o.uid,"3",this.forumId).then((function(t){var e=0==t.data.result?"已封鎖使用者 - <".concat(o.author_name,">"):t.data.message;s.$q.notify({message:e});s.$_.remove(s.topicReply,(function(t){return t.author==o.author}));s.topicReply.splice(0,0)})).catch((function(t){})).then((function(){}));break;case"report":this.reportContent(o.uid,i,a);break}},reportContent:function(t,e,o){var i=this;this.$q.bottomSheet({message:"請選擇您檢舉的理由",actions:[{label:"這是垃圾訊息",id:"hide",rpt_type:"1"},{label:"內容不適當",id:"report",rpt_type:"2"}]}).onOk((function(a){i.$api.forum.ForumReport(t,a.rpt_type,i.forumId).then((function(t){console.log(t);var a=0==t.data.result?"此文章已過濾":t.data.message;i.$q.notify({message:a}),o?i.$router.go(-1):i.topicReply.splice(e,1)})).catch((function(t){})).then((function(){}))})).onCancel((function(){})).onDismiss((function(){}))}}},r=n,c=o("2877"),l=o("9989"),u=o("f09f"),m=o("66e5"),d=o("4074"),f=o("cb32"),p=o("0170"),h=o("9c40"),y=o("a370"),b=o("27f9"),g=o("ef35"),_=o("d9b2"),q=o("eebe"),v=o.n(q),k=Object(c["a"])(r,i,a,!1,null,null,null);e["default"]=k.exports;v()(k,"components",{QPage:l["a"],QCard:u["a"],QItem:m["a"],QItemSection:d["a"],QAvatar:f["a"],QItemLabel:p["a"],QBtn:h["a"],QCardSection:y["a"],QInput:b["a"],QInfiniteScroll:g["a"],QSpinnerIos:_["a"]})}}]);