(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[15],{7454:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("q-page",{staticClass:"bg-background-light"},[i("div",{staticStyle:{"padding-bottom":"56px"}},[i("q-infinite-scroll",{ref:"forum",attrs:{id:t.$store.state.global.gaHead+"communitydetail_scrolldepth",offset:250,"initial-index":0},on:{load:t.onLoad},scopedSlots:t._u([{key:"loading",fn:function(){return[i("div",{staticClass:"full-width text-center q-pa-md "},[i("q-spinner-ios",{attrs:{size:"30px",color:"bluegrey"}})],1)]},proxy:!0}])},t._l(t.dataList,(function(e,n){return i("q-card",{key:n,staticClass:" q-pt-sm ",staticStyle:{"margin-bottom":"12px"},attrs:{flat:"",square:""}},[i("q-item",{staticClass:"q-pb-none"},[i("q-item-section",{staticStyle:{"min-width":"38px","padding-right":"12px"},attrs:{avatar:""}},[i("q-avatar",{attrs:{size:"38px"}},[i("img",{attrs:{src:e.author_head}})])],1),i("q-item-section",{attrs:{"no-wrap":""}},[i("q-item-label",{staticClass:"text-color-1 text-bold text-subtitle1"},[t._v(t._s(e.author_name))]),i("q-item-label",{staticClass:"text-color-2",attrs:{caption:""}},[t._v(t._s(e.time_before))])],1),i("q-item-section",{attrs:{side:"",top:""}},[i("div",{staticClass:"row"},[i("q-btn",{attrs:{flat:"",dense:"",round:"",icon:e.pin?"push_pin":"o_push_pin"},on:{click:function(i){return t.pinPost(e)}}}),e.author==t.$store.state.account.id?i("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"more_vert"},on:{click:function(i){return t.myActions(e,n)}}}):i("q-btn",{attrs:{flat:"",dense:"",round:"",icon:"more_vert"},on:{click:function(i){return t.block(e,n)}}})],1)])],1),i("q-card-section",{attrs:{horizontal:""}},[i("q-card-section",{staticClass:"text-color-2",domProps:{innerHTML:t._s(e.content)}})],1),i("q-item",{staticClass:"q-py-none",attrs:{dense:""}},[i("q-item-section",[i("q-item-label",[i("q-btn",{attrs:{id:t.$store.state.global.gaHead+"communitydetail_post_like",dense:"",flat:"",align:"left",icon:e.my_like?"favorite":"favorite_border",label:e.likes_count,"text-color":e.my_like?"redheart":"text-color-2"},on:{click:function(i){return t.like(e,!e.my_like)}}})],1)],1),i("q-item-section",[i("q-item-label",[i("q-btn",{attrs:{id:t.$store.state.global.gaHead+"communitydetail_more",dense:"",flat:"",to:"/community/feeds-reply/"+t.forumId+"/"+e.uid,align:"left",icon:"far fa-comment",label:e.reply_count,"text-color":"text-color-2"}})],1)],1)],1),i("q-list",{staticClass:"bg-paleGrey",attrs:{separator:""}},[e.reply_count>3?i("q-item",{attrs:{dense:""}},[i("q-item-section",{staticClass:"text-center text-bold text-toggle-blue",on:{click:function(i){return t.$router.push("/community/feeds-reply/"+t.forumId+"/"+e.uid)}}},[t._v("\n              還有\n              "+t._s(e.reply_count>3?e.reply_count-3:0)+" 則留言\n            ")])],1):t._e(),t._l(e.reply,(function(e){return i("q-item",{key:e.uid,staticStyle:{"padding-bottom":"10px"}},[i("q-item-section",{staticStyle:{color:"#1C1C1E"}},[i("q-item-label",{staticClass:"q-mb-xs text-bold"},[t._v(t._s(e.author_name))]),i("q-item-label",{domProps:{innerHTML:t._s(e.content)}})],1),i("q-item-section",{staticClass:"text-bluegrey",attrs:{side:""}},[t._v(t._s(e.time_before))])],1)}))],2)],1)})),1)],1),i("q-footer",{attrs:{id:"footer"}},[i("div",{staticClass:"bg-feeds-messagebg row bg-feeds-messagebg q-col-gutter-sm items-center q-pb-sm q-pl-sm q-pr-sm ",attrs:{id:"community-sendBox"}},[i("div",{staticClass:"col-auto "},[i("q-avatar",{attrs:{size:"33px"}},[i("img",{attrs:{src:t.$store.state.account.head}})])],1),i("div",{staticClass:"col full-width"},[i("q-input",{staticClass:"bg-white",attrs:{dense:"",clearable:"",color:"blueGrey",autogrow:"",outlined:"",placeholder:"以"+t.$store.state.account.user.account+" 發表回應"},model:{value:t.message,callback:function(e){t.message=e},expression:"message"}})],1),i("div",{staticClass:"col-auto"},[i("q-btn",{attrs:{id:t.$store.state.global.gaHead+"communitydetail_post_comment",dense:"",round:"",flat:"",icon:"send",disable:!t.message,color:"blueGrey"},on:{click:t.postComment}})],1)])]),i("q-inner-loading",{staticClass:"text-main ",attrs:{showing:t.isLoading,"transition-show":"fade","transition-hide":"fade"}},[i("div",{staticClass:"text-h6 text-blueGrey text-bold q-pb-md"},[t._v("讀取中")]),i("q-spinner-gears",{attrs:{size:"45px",color:t.gearColor}})],1)],1)},a=[],o=(i("20d6"),i("f751"),i("7f7f"),i("6b54"),i("06db"),i("7514"),i("872c")),s={mixins:[o["a"]],mounted:function(){var t=this;this.forumId=this.$route.params.forumId,this.forum=this.$_.find(this.$store.state.system.forums,(function(e){return t.forumId==e.id.toString()})),this.forumAdminList.push(this.forum.host.email),this.forum.managers.forEach((function(e){t.forumAdminList.push(e.email)})),this.title=this.forum.name,this.dataList=[]},data:function(){return{forum:{},forumId:this.$route.params.forumId,isLoading:!1,message:"",dataList:[],forumAdminList:[]}},computed:{isAdmin:function(){return this.forumAdminList.indexOf(this.$store.state.account.user.email)>=0}},methods:{init:function(){this.dataList=[],this.$refs.forum.reset(),this.$refs.forum.poll()},onLoad:function(t,e){var i=this;console.log(this.forumId),this.$api.forum.ForumList(this.forumId,t-1).then((function(t){var n=t.data;0==n.data.length?e(!0):e(),n.data.forEach((function(t){t.origin_content=t.content,t.origin_reply=Object.assign([],t.reply),t.content=t.content.replaceAll("\n","<br/>"),t.reply.length>0&&t.reply.forEach((function(t){t.content=t.content.replaceAll("\n","<br/>")}))})),i.dataList=i.$_.concat(i.dataList,n.data)})).catch((function(t){})).then((function(){0}))},pinPost:function(t){this.isAdmin&&(t.pin=!t.pin,this.$api.forum.ForumPinPost(t.uid,t.pin,this.forumId).then((function(t){})).catch((function(t){})).then((function(){})))},postComment:function(){var t=this;this.isLoading=!0,this.$api.forum.ForumPost(this.message,this.forumId).then((function(e){var i={author:t.$store.state.account.id,author_head:t.$store.state.account.head,author_name:t.$store.state.account.user.account,content:t.message.replaceAll("\n","<br/>"),original_content:t.message,original_reply:[],pin:!1,forum_id:t.forumId,likes_count:0,my_like:!1,reply:[],reply_count:0,time:"",time_before:"剛才",uid:e.data.data.new_id},n=t.$_.findIndex(t.dataList,(function(t){return!t.pin}));t.dataList.splice(n,0,i),t.message=""})).catch((function(t){})).then((function(){t.isLoading=!1}))},like:function(t,e){var i=t.my_like;t.my_like=e,e?t.likes_count++:t.likes_count--,this.$api.forum.ForumLike(t.uid,e,this.forumId).then((function(t){})).catch((function(n){t.my_like=i,e?t.likes_count--:t.likes_count++}))},myActions:function(t,e){var i=this,n=this.$q.bottomSheet({class:"sheet-actions",actions:[{label:"刪除",id:"delete"},{label:"取消",id:"cancel"}]}).onOk((function(a){i.forumAction(a,n,t,e)}))},block:function(t,e){var i=this,n=[{label:"封鎖使用者",id:"user"},{label:"隱藏此貼文",id:"hide"},{label:"檢舉此貼文",id:"report"},{label:"取消",id:"cancel"}];this.isAdmin&&n.splice(0,0,{label:"刪除(管理者)",id:"delete"});var a=this.$q.bottomSheet({class:"sheet-actions",actions:n}).onOk((function(n){i.forumAction(n,a,t,e)})).onCancel((function(){})).onDismiss((function(){}))},forumAction:function(t,e,i,n){var a=this;switch(t.id){case"delete":this.$api.forum.ForumRemove(i.uid,this.forumId).then((function(t){var e=0==t.data.result?"此文章已刪除":t.data.message;a.$q.notify({message:e}),a.dataList.splice(n,1)})).catch((function(t){})).then((function(){}));break;case"cancel":e.hide();break;case"hide":this.$api.forum.ForumHide(i.uid,this.forumId).then((function(t){var e=0==t.data.result?"此文章已過濾":t.data.message;a.$q.notify({message:e}),a.dataList.splice(n,1)})).catch((function(t){})).then((function(){}));break;case"user":this.$api.forum.ForumReport(i.uid,"3",this.forumId).then((function(t){var e=0==t.data.result?"已封鎖使用者 - <".concat(i.author_name,">"):t.data.message;a.$q.notify({message:e});a.$_.remove(a.dataList,(function(t){return t.author==i.author}));a.dataList.splice(0,0)})).catch((function(t){})).then((function(){}));break;case"report":this.reportContent(i.uid,n);break}},reportContent:function(t,e){var i=this;this.$q.bottomSheet({class:"sheet-report",message:"請選擇您檢舉的理由",actions:[{label:"這是垃圾訊息",id:"hide",rpt_type:"1"},{label:"內容不適當",id:"report",rpt_type:"2"}]}).onOk((function(n){i.$api.forum.ForumReport(t,n.rpt_type,i.forumId).then((function(t){var n=0==t.data.result?"此文章已過濾":t.data.message;i.$q.notify({message:n}),i.dataList.splice(e,1)})).catch((function(t){})).then((function(){}))})).onCancel((function(){})).onDismiss((function(){}))}}},r=s,c=i("2877"),l=i("9989"),u=i("ef35"),d=i("d9b2"),m=i("f09f"),f=i("66e5"),h=i("4074"),p=i("cb32"),b=i("0170"),g=i("9c40"),_=i("a370"),q=i("1c1c"),y=i("7ff0"),v=i("27f9"),k=i("74f7"),x=i("cf57"),$=i("eebe"),C=i.n($),L=Object(c["a"])(r,n,a,!1,null,null,null);e["default"]=L.exports;C()(L,"components",{QPage:l["a"],QInfiniteScroll:u["a"],QSpinnerIos:d["a"],QCard:m["a"],QItem:f["a"],QItemSection:h["a"],QAvatar:p["a"],QItemLabel:b["a"],QBtn:g["a"],QCardSection:_["a"],QList:q["a"],QFooter:y["a"],QInput:v["a"],QInnerLoading:k["a"],QSpinnerGears:x["a"]})}}]);